{% load static %}
{% load product_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>{% block title %}SeoSeung-Soo{% endblock %}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'images/favicon/seoseungsoo-logo-circle.png' %}">
    <meta name="naver-site-verification" content="5a922f8af5ab772e7424d225ca1284224ec75110" />
    <meta name="robots" content="index,follow">
    <meta name="description" content="서승수는 가족에게 따뜻함과 신뢰를 전하고자 합니다.">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/chats/chat.css' %}">
    <meta property="og:type" content="website"> 
    <meta property="og:title" content="SeoSeung-Soo">
    <meta property="og:description" content="서승수는 가족에게 따뜻함과 신뢰를 전하고자 합니다.">
    <meta property="og:image" content="https://seoseung-soo.com/static/images/seoseungsoo/logos/OpenGraph.png">
    <meta property="og:url" content="https://seoseung-soo.com">
    {% block style %}
    {% endblock %}
</head>
<body>
    <header class="site-header">
        <div class="header-bar">
            <div class="left-actions">
                <button class="menu-toggle" aria-label="Toggle menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
            <a href="/" class="logo">
                SeoSeung-Soo
            </a>
            <nav class="top-nav">
                {% if user.is_authenticated and user.role == 'admin' %}
                <a href="{% url 'admin-mypage' %}">ADMIN</a>
                {% endif %}
                {% if not user.is_authenticated %}
                <a href="{% url "login" %}">LOGIN</a>
                {% endif %}
                {% if user.is_authenticated %}
                <a href="/users/logout/">LOGOUT</a>
                {% endif %}
                {% if not user.is_authenticated %}
                <a href="{% url "login" %}">MYPAGE</a>
                {% elif user.is_authenticated %}
                <a href="/users/mypage/">MYPAGE</a>
                {% endif %}
                <div class="search-toggle-wrapper">
                    <a href="#" class="search-toggle-btn" id="searchToggle">SEARCH</a>
                    <div class="search-dropdown" id="searchDropdown">
                        <form method="get" action="{% url 'customer-product-list' %}" class="search-dropdown-form">
                            <input type="text" name="search" placeholder="검색어를 입력하세요" class="search-dropdown-input" value="{{ request.GET.search }}">
                            <button type="submit" class="search-dropdown-btn" aria-label="검색">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                            </button>
                        </form>
                    </div>
                </div>
            </nav>
        </div>
        
{#        <div class="desktop-sub-categories">#}
{#            {% for main_category in main_categories %}#}
{#            <div class="desktop-sub-category-section" data-parent="category-{{ main_category.id }}">#}
{#                <nav class="desktop-sub-category-nav">#}
{#                    {% for sub_category in main_category.children.all %}#}
{#                    <a href="#">{{ sub_category.name }}</a>#}
{#                    {% empty %}#}
{#                    <span class="no-subcategory">소분류가 없습니다</span>#}
{#                    {% endfor %}#}
{#                </nav>#}
{#            </div>#}
{#            {% endfor %}#}
{#        </div>#}
        
        <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
        
        <div class="mobile-menu" id="mobileMenu" tabindex="-1" aria-labelledby="offcanvasMenuLabel" role="dialog" aria-modal="true">
            <div class="mobile-menu-header">
                <h3 id="offcanvasMenuLabel">MENU</h3>
                <button class="mobile-menu-close" id="mobileMenuClose" aria-label="메뉴 닫기">×</button>
            </div>
            <div class="mobile-menu-body">
                <nav class="mobile-main-category">
                    {% for main_category in main_categories %}
                        <a href="{% url 'customer-product-list' %}?category={{ main_category.name }}" data-category="category-{{ main_category.id }}">{{ main_category.name|upper }}</a>
                    {% endfor %}
                </nav>
                
                <div class="mobile-sub-categories">
                    {% for main_category in main_categories %}
                    <div class="sub-category-section" data-parent="category-{{ main_category.id }}">
                        <nav class="sub-category-nav">
                            {% for sub_category in main_category.children.all %}
                            <a href="{% url 'customer-product-list' %}?category={{ sub_category.name }}" data-category="category-{{ sub_category.id }}">{{ sub_category.name }}</a>
                            {% empty %}
                            <a class="no-subcategory">소분류가 없습니다</a>
                            {% endfor %}
                        </nav>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="mobile-search-box">
                    <form method="get" action="{% url 'customer-product-list' %}" class="search-form">
                        <input type="text" name="search" placeholder="검색어를 입력하세요" class="mobile-search-input" value="{{ request.GET.search }}">
                        <button type="submit" class="mobile-search-btn" aria-label="검색"></button>
                    </form>
                </div>
                <nav class="mobile-user-nav">
                    {% if user.is_authenticated and user.role == 'admin' %}
                    <a href="{% url 'product-list' %}">ADMIN</a>
                    {% endif %}
                    {% if not user.is_authenticated %}
                    <a href="{% url "login" %}">LOGIN</a>
                    {% endif %}
                    {% if user.is_authenticated %}
                    <a href={% url "logout" %}>LOGOUT</a>
                    {% endif %}                
                    {% if not user.is_authenticated %}
                    <a href="{% url "login" %}">MYPAGE</a>
                    {% elif user.is_authenticated %}
                    <a href={% url "mypage" %}>MYPAGE</a>
                    {% endif %}
                </nav>
            </div>
        </div>
    </header>

    <main class="container">
        {% block content %}
        {% endblock %}
    </main>
    <div class="floating-chat">
        <div class="chat-button" id="chatButton">
            <img src="{% static 'images/seoseungsoo/logos/non_white_logo.png' %}" alt="SeoSeung-Soo Logo" class="chat-logo">
            <div class="chat-text">CHAT</div>
        </div>
    </div>

    <div class="chat-window" id="chatWindow">
        <div class="chat-window-header">
            <div class="chat-header-slide active" id="chatHeaderLogo">
                <img src="{% static 'images/seoseungsoo/logos/non_black_logo.png' %}" alt="SeoSeung-Soo" class="chat-window-logo">
            </div>
            <div class="chat-header-slide" id="chatHeaderBack">
                <button type="button" class="chat-back-btn" id="inquireBackBtn">‹</button>
                <h3 class="chat-header-title">문의하기</h3>
            </div>
            <button class="chat-close-btn" id="chatCloseBtn">×</button>
        </div>
        <div class="chat-window-body">
            <div class="chat-content-wrapper">
                <div class="chat-news-feed chat-slide active" id="newsFeedSlide">
                    <div class="news-feed-header">
                        <h3>NEW PRODUCTS</h3>
                        <div class="news-feed-nav desktop-only">
                            <button class="news-feed-nav-btn news-feed-prev" id="newsFeedPrev">‹</button>
                            <button class="news-feed-nav-btn news-feed-next" id="newsFeedNext">›</button>
                        </div>
                    </div>
                    <div class="news-feed-container">
                        <div class="news-feed-grid" id="newsFeedGrid">
                            {% for product in new_products %}
                            <a href="{% url 'products-detail' product.name|product_slug %}" class="news-feed-item">
                                {% if product.image.first %}
                                    <img src="{{ product.image.first.image.url }}" alt="{{ product.name }}">
                                {% else %}
                                    <div class="news-feed-placeholder">No Image</div>
                                {% endif %}
                                <div class="news-feed-overlay">
                                    <span class="news-feed-name">{{ product.name|truncatechars:15 }}</span>
                                </div>
                            </a>
                            {% empty %}
                            <div class="no-new-products">
                                <p>새로운 상품이 없습니다.</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="chat-action-buttons">
                        <button type="button" class="chat-action-btn" id="inquireBtn">
                            <span>문의하기</span>
                            <span class="arrow">→</span>
                        </button>
                        <a href="#" class="chat-action-btn" id="faqBtn">
                            <span>자주 묻는 질문</span>
                            <span class="arrow">→</span>
                        </a>
                    </div>
                    <div class="chat-info-message">
                        <p class="chat-info-text">서승수는 세 남매의 이름에서 시작된 브랜드입니다.</p>
                        <p class="chat-info-text">가족에게 주는 마음으로, 고객에게도 같은 따뜻함과 신뢰를 전하고자 합니다.</p>
                        <p class="chat-info-text">화려하진 않지만, 진심이 담긴 옷과 제품으로</p>
                        <p class="chat-info-text">당신의 일상 속 작은 편안함이 되고 싶습니다.</p>
                    </div>
                </div>
                <div class="chat-inquire-form-container chat-slide" id="inquireFormSlide">
                    <form method="post" action="{% url 'inquire' %}" class="chat-inquire-form" id="chatInquireForm">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="chat_email" class="form-label">이메일 주소</label>
                            <input type="email" id="chat_email" name="email" class="form-input" placeholder="답변받을 이메일 주소를 입력해주세요." value="{% if user.is_authenticated %}{{ user.email }}{% endif %}">
                        </div>
                        <div class="form-group">
                            <label for="chat_item" class="form-label">문의 유형</label>
                            <select id="chat_item" name="item" class="form-select">
                                <option value="delivery">상품 불량/교환 문의</option>
                                <option value="etc">기타 문의</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="chat_title" class="form-label">제목</label>
                            <input type="text" id="chat_title" name="title" class="form-input" placeholder="문의 제목을 입력해주세요." required>
                        </div>
                        <div class="form-group">
                            <label for="chat_content" class="form-label">문의 내용</label>
                            <textarea id="chat_content" name="content" class="form-textarea" placeholder="문의하실 내용을 자세히 적어주세요." required></textarea>
                            <span class="form-help">최대 1000자</span>
                        </div>
                        <button type="submit" class="chat-submit-btn">문의하기</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

     <div id="toast-container" class="toast-container"></div>
    <footer class="site-footer">
        <div class="container">
            <p style="text-align: left">CEO : 정수지</p>
            <p style="text-align: center">© SeoSeung-Soo. All rights reserved.</p>

        </div>
    </footer>

    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/prevent-drag.js' %}"></script>
    <script src="{% static 'js/toast.js' %}"></script>
    <script src="{% static 'js/chats/chat.js' %}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>