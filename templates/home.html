{% extends "base.html" %}
{% load static %}
{% load product_filters %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}

{% block title %}
SEOSEUNG-SOO | 서승수 온라인 스토어
{% endblock %}

{% block content %}
  <section class="hero">
    <div class="hero-slide">
      {% if site_settings.hero_image %}
        <img src="{{ site_settings.hero_image.url }}" alt="Hero" class="hero-img">
      {% endif %}
      <div class="hero-text">
        <h2>{{ site_settings.hero_title|default:"New Season" }}</h2>
        <p>{{ site_settings.hero_subtitle|default:"가장 사랑받는 아이템을 만나보세요." }}</p>
      </div>
    </div>
  </section>

  <section class="section">
    <h3 class="section-title">STEADY SELLER</h3>
    <p class="section-sub">가장 많은 사랑을 받은 상품입니다.</p>
    <div class="product-grid">
      {% for product in products %}
      <article class="product-card">
        <a href="{% url 'products-detail' product.name|product_slug %}" class="product-thumb" aria-label="상품 상세">
          {% if product.image.first %}
            <img src="{{ product.image.first.image.url }}" alt="{{ product.name }}" class="product-image-primary">
            {% if product.image.all|length > 1 %}
              <img src="{{ product.image.all.1.image.url }}" alt="{{ product.name }}" class="product-image-hover">
            {% else %}
              <img src="{{ product.image.first.image.url }}" alt="{{ product.name }}" class="product-image-hover">
            {% endif %}
          {% else %}
            <img src="https://picsum.photos/seed/{{ forloop.counter }}/600/750" alt="{{ product.name }}" class="product-image-primary">
            <img src="https://picsum.photos/seed/{{ forloop.counter|add:100 }}/600/750" alt="{{ product.name }}" class="product-image-hover">
          {% endif %}
        </a>
        <div class="product-info">
          <h4 class="product-name">{{ product.name }}</h4>
          <div class="product-colors">
            {% for color in product.colors.all %}
            <span class="product-color" style="background-color: {% if color.hex_code %}{{ color.hex_code }}{% else %}#e5e7eb{% endif %};"></span>
            {% endfor %}
          </div>
          <div class="product-price">
            {% if product.sale_price %}
              <span class="sale">{{ product.price|discount_amount:product.sale_price|intcomma }}원</span>
              <span class="origin">{{ product.price|intcomma }}원</span>
            {% else %}
              <span class="price">{{ product.price|intcomma }}원</span>
            {% endif %}
          </div>
        </div>
      </article>
      {% empty %}
      <div class="empty-products">
        <p>등록된 상품이 없습니다.</p>
      </div>
      {% endfor %}
    </div>
  </section>

  <div class="event-popup-overlay" id="eventPopupOverlay">
    <div class="event-popup">
      <div class="event-popup-header">
        <span>EVENT</span>
        <button class="event-popup-close" id="eventPopupClose">&times;</button>
      </div>
      <div class="event-popup-body">
        <div class="event-popup-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#1b1b1b" stroke-width="1.5">
            <path d="M20 12v10H4V12"></path>
            <path d="M2 7h20v5H2z"></path>
            <path d="M12 22V7"></path>
            <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
            <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
          </svg>
        </div>
        <h3>신규 회원 혜택</h3>
        <p>회원가입 시 <strong>5,000P</strong> 즉시 지급!</p>
        <p class="event-sub"></p>
        <a href="{% url 'signup' %}" class="event-popup-btn">회원가입 하러가기</a>
      </div>
      <div class="event-popup-footer">
        <label class="event-today-check">
          <input type="checkbox" id="eventTodayHide">
          <span>오늘 하루 보지 않기</span>
        </label>
      </div>
    </div>
  </div>

  <div class="cookie-banner" id="cookieBanner">
    <div class="cookie-banner-content">
      <div class="cookie-text">
        <p><strong>쿠키 사용 안내</strong></p>
        <p>SeoSeung-Soo는 더 나은 서비스 제공을 위해 쿠키를 사용합니다. 사이트를 계속 이용하시면 쿠키 사용에 동의하시게 됩니다.</p>
      </div>
      <div class="cookie-actions">
        <button class="cookie-btn cookie-accept" id="cookieAccept">동의</button>
        <button class="cookie-btn cookie-decline" id="cookieDecline">거부</button>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/home.js' %}"></script>
{% endblock %}